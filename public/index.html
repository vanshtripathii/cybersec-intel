<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Elite CyberSec Intel Dashboard</title>
  <style>
  * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 50%, #0f1525 100%);
  color: #ffffff;
  overflow-x: hidden;
  position: relative;
}

/* Animated Code Background */
.code-background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  opacity: 0.5;
  overflow: hidden;
  font-family: 'Courier New', monospace;
  font-size: 12px;
  line-height: 1.4;
  color: #00bbff;
  pointer-events: none;
}

.code-line {
  position: absolute;
  white-space: nowrap;
  animation: scrollCode 10s linear infinite;
}

.code-line:nth-child(odd) {
  animation-direction: reverse;
  animation-duration: 25s;
}

.code-line:nth-child(1) { top: 5%; animation-delay: 0s; }
.code-line:nth-child(2) { top: 15%; animation-delay: -3s; }
.code-line:nth-child(3) { top: 25%; animation-delay: -6s; }
.code-line:nth-child(4) { top: 35%; animation-delay: -9s; }
.code-line:nth-child(5) { top: 45%; animation-delay: -12s; }
.code-line:nth-child(6) { top: 55%; animation-delay: -15s; }
.code-line:nth-child(7) { top: 65%; animation-delay: -18s; }
.code-line:nth-child(8) { top: 75%; animation-delay: -21s; }
.code-line:nth-child(9) { top: 85%; animation-delay: -24s; }
.code-line:nth-child(10) { top: 95%; animation-delay: -27s; }

@keyframes scrollCode {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100vw); }
}

/* Subtle blue gradient overlay */
.bg-animation {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle at 20% 20%, rgba(0, 122, 255, 0.05) 0%, transparent 50%),
              radial-gradient(circle at 80% 80%, rgba(0, 150, 255, 0.05) 0%, transparent 50%);
  z-index: -1;
}

header {
  background: linear-gradient(135deg, #000000 0%, #0a1025 100%);
  padding: 2rem 1rem;
  text-align: center;
  position: relative;
  overflow: hidden;
  border-bottom: 3px solid #0080ff;
}

.title {
  font-size: 3rem;
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: 3px;
  background: linear-gradient(45deg, #0080ff, #00d4ff, #4da6ff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 0.5rem;
  text-shadow: 0 0 30px rgba(0, 128, 255, 0.3);
}

.subtitle {
  font-size: 1.2rem;
  opacity: 0.8;
  text-transform: uppercase;
  letter-spacing: 2px;
  color: #b3d9ff;
}

.stats-bar {
  display: flex;
  justify-content: center;
  gap: 3rem;
  padding: 1.5rem;
  background: rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(0, 128, 255, 0.2);
}

.stat-item {
  text-align: center;
  position: relative;
}

.stat-number {
  font-size: 2rem;
  font-weight: bold;
  margin-bottom: 0.5rem;
  transition: all 0.3s ease;
}

.stat-label {
  font-size: 0.9rem;
  opacity: 0.7;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.critical-count { color: #ff6b6b; }
.high-count { color: #ff8c42; }
.medium-count { color: #ffd93d; }
.low-count { color: #4da6ff; }

.time-controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 2rem;
  padding: 1.5rem;
  background: rgba(0, 0, 0, 0.2);
  border-bottom: 1px solid rgba(0, 128, 255, 0.2);
  flex-wrap: wrap;
}

.time-range-buttons {
  display: flex;
  gap: 0.5rem;
}

.time-btn {
  padding: 0.5rem 1rem;
  border: 2px solid rgba(0, 128, 255, 0.3);
  background: rgba(0, 64, 128, 0.2);
  color: #b3d9ff;
  border-radius: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  font-size: 0.8rem;
}

.time-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 128, 255, 0.2);
  background: rgba(0, 128, 255, 0.3);
  color: #ffffff;
}

.time-btn.active {
  background: linear-gradient(45deg, #0080ff, #00d4ff);
  border-color: #0080ff;
  color: #ffffff;
}

.time-btn.active:hover {
  background: linear-gradient(45deg, #0080ff, #00d4ff);
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 128, 255, 0.4);
}

.date-picker-container {
  display: none;
  align-items: center;
  gap: 1rem;
}

.date-input {
  padding: 0.75rem 1rem;
  border: 2px solid rgba(0, 128, 255, 0.3);
  background: rgba(0, 64, 128, 0.2);
  color: #b3d9ff;
  border-radius: 10px;
  font-size: 0.9rem;
  transition: all 0.3s ease;
}

.date-input:focus {
  outline: none;
  border-color: #0080ff;
  box-shadow: 0 0 15px rgba(0, 128, 255, 0.3);
  background: rgba(0, 64, 128, 0.3);
}

.date-input::-webkit-calendar-picker-indicator {
  filter: invert(1);
  cursor: pointer;
}

.calendar-label {
  font-size: 0.9rem;
  opacity: 0.8;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: #b3d9ff;
}

.refresh-btn, .search-btn {
  padding: 0.75rem 1.5rem;
  background: linear-gradient(45deg, #0080ff, #00d4ff);
  border: none;
  color: white;
  border-radius: 25px;
  cursor: pointer;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  transition: all 0.3s ease;
}

.refresh-btn:hover, .search-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 128, 255, 0.3);
}

.filter-bar {
  display: flex;
  justify-content: center;
  gap: 1rem;
  padding: 1.5rem;
  background: rgba(0, 0, 0, 0.2);
}

.filter-btn {
  padding: 0.75rem 1.5rem;
  border: 2px solid transparent;
  background: rgba(0, 64, 128, 0.2);
  color: #b3d9ff;
  border-radius: 25px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.filter-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 128, 255, 0.2);
  background: rgba(0, 128, 255, 0.3);
}

.filter-btn.active {
  background: linear-gradient(45deg, #0080ff, #00d4ff);
  border-color: #0080ff;
  color: #ffffff;
}

.news-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 2rem;
  padding: 2rem;
  max-width: 1400px;
  margin: 0 auto;
}

.news-card {
  background: linear-gradient(145deg, rgba(0, 64, 128, 0.1), rgba(0, 32, 64, 0.15));
  border-radius: 20px;
  padding: 1.5rem;
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(0, 128, 255, 0.2);
  transition: all 0.3s ease;
  cursor: pointer;
  min-height: 300px;
  display: flex;
  flex-direction: column;
  padding-top: 3rem;
}

.news-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 20px 40px rgba(0, 128, 255, 0.15);
  border-color: rgba(0, 128, 255, 0.4);
}

.news-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 4px;
  background: var(--severity-color);
}

.news-card.critical::before { background: linear-gradient(90deg, #ff6b6b, #ff5252); }
.news-card.high::before { background: linear-gradient(90deg, #ff8c42, #ff7043); }
.news-card.medium::before { background: linear-gradient(90deg, #ffd93d, #ffc107); }
.news-card.low::before { background: linear-gradient(90deg, #4da6ff, #2196f3); }

.severity-badge {
  position: absolute;
  top: 1rem;
  right: 1rem;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
  z-index: 2;
  max-width: 100px;
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
}

.severity-badge.critical {
  background: linear-gradient(45deg, #ff6b6b, #ff5252);
  box-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
}

.severity-badge.high {
  background: linear-gradient(45deg, #ff8c42, #ff7043);
  box-shadow: 0 0 20px rgba(255, 140, 66, 0.3);
}

.severity-badge.medium {
  background: linear-gradient(45deg, #ffd93d, #ffc107);
  box-shadow: 0 0 20px rgba(255, 217, 61, 0.3);
}

.severity-badge.low {
  background: linear-gradient(45deg, #4da6ff, #2196f3);
  box-shadow: 0 0 20px rgba(77, 166, 255, 0.3);
}

.news-card-content {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
}

.news-card h3 {
  margin: 0;
  font-size: 1.4rem;
  line-height: 1.4;
  color: #ffffff;
  padding-right: 30px;
}

.preview-content {
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.6;
  color: rgba(255, 255, 255, 0.7);
  margin: 0;
}

.news-card-footer {
  margin-top: auto;
  padding-top: 1rem;
  border-top: 1px solid rgba(0, 128, 255, 0.2);
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.source-link {
  display: inline-block;
  margin-top: 1rem;
  color: #00d4ff;
  text-decoration: none;
  font-size: 0.9rem;
  transition: all 0.3s ease;
}

.source-link:hover {
  text-decoration: underline;
  color: #0080ff;
}

.summarize-btn {
  padding: 0.5rem 1rem;
  background: linear-gradient(45deg, #0080ff, #00d4ff);
  border: none;
  border-radius: 20px;
  color: white;
  font-size: 0.8rem;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-top: auto;
  align-self: flex-start;
}

.summarize-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 128, 255, 0.3);
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(10px);
  z-index: 1000;
  overflow-y: auto;
}

.modal-content {
  background: linear-gradient(145deg, #0a0a1a, #1a1a2e);
  margin: 5% auto;
  padding: 2rem;
  border-radius: 20px;
  max-width: 800px;
  border: 1px solid rgba(0, 128, 255, 0.3);
  position: relative;
}

.close-modal {
  position: absolute;
  top: 1rem;
  right: 1rem;
  font-size: 2rem;
  color: rgba(0, 128, 255, 0.6);
  cursor: pointer;
  transition: all 0.3s ease;
}

.close-modal:hover {
  color: #00d4ff;
  transform: rotate(90deg);
}

.modal-severity {
  display: inline-block;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.9rem;
  font-weight: bold;
  text-transform: uppercase;
  margin-bottom: 1rem;
}

.modal-meta {
  display: flex;
  justify-content: space-between;
  margin-bottom: 1.5rem;
  color: rgba(255, 255, 255, 0.7);
  font-size: 0.9rem;
}

.modal-summary {
  white-space: pre-line;
  line-height: 1.8;
  margin-bottom: 2rem;
  color: rgba(255, 255, 255, 0.9);
}

.technical-details {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px dashed rgba(0, 128, 255, 0.3);
  color: #00d4ff;
  font-size: 0.9em;
}

.technical-details ul {
  margin-left: 1.5rem;
}

.technical-details li {
  margin-bottom: 0.5rem;
}

/* IOC Section Styles */
.ioc-section {
  margin-top: 1.5rem;
  padding: 1rem;
  background: rgba(0, 32, 64, 0.2);
  border-radius: 10px;
  border-left: 3px solid #0080ff;
}

.ioc-section h4 {
  margin-bottom: 0.5rem;
  color: #00d4ff;
  border-bottom: 1px solid rgba(0, 128, 255, 0.3);
  padding-bottom: 0.5rem;
}

.ioc-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.ioc-item {
  padding: 0.5rem;
  background: rgba(0, 64, 128, 0.3);
  border-radius: 5px;
  font-family: monospace;
  font-size: 0.85rem;
  word-break: break-all;
}

.ioc-item a {
  color: #00d4ff;
  text-decoration: none;
}

.ioc-item a:hover {
  text-decoration: underline;
}

.ioc-toggle {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-top: 1rem;
  cursor: pointer;
  color: #00d4ff;
  font-weight: bold;
}

.ioc-toggle:hover {
  text-decoration: underline;
}

.ioc-container {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
}

.ioc-container.expanded {
  max-height: 1000px;
}

.loading {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 200px;
  font-size: 1.2rem;
  color: rgba(255, 255, 255, 0.6);
}

.loading-summary {
  display: flex;
  align-items: center;
  color: rgba(255, 255, 255, 0.7);
  font-size: 0.9rem;
}

.spinner {
  width: 20px;
  height: 20px;
  border: 2px solid rgba(0, 128, 255, 0.2);
  border-top: 2px solid #00d4ff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-right: 0.5rem;
}

.spinner.large {
  width: 40px;
  height: 40px;
  border-width: 4px;
  margin-right: 1rem;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.alert-banner {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  background: linear-gradient(90deg, #ff6b6b, #ff5252);
  color: white;
  padding: 1px;
  text-align: center;
  font-weight: bold;
  transform: translateY(-100%);
  transition: transform 0.3s ease;
  z-index: 1000;
}

.alert-banner.show {
  transform: translateY(0);
}

.no-articles {
  text-align: center;
  padding: 3rem;
  color: rgba(255, 255, 255, 0.6);
  font-size: 1.2rem;
}

.time-info {
  text-align: center;
  padding: 1rem;
  background: rgba(0, 0, 0, 0.2);
  color: rgba(179, 217, 255, 0.8);
  font-size: 0.9rem;
  border-bottom: 1px solid rgba(0, 128, 255, 0.2);
}

.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: linear-gradient(45deg, #0080ff, #00d4ff);
  color: white;
  padding: 1rem 2rem;
  border-radius: 10px;
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: 1000;
}

.toast.show {
  opacity: 1;
}

.error-state {
  text-align: center;
  padding: 2rem;
  color: #ff6b6b;
}

@media (max-width: 768px) {
  .title { font-size: 2rem; }
  .stats-bar { flex-direction: column; gap: 1rem; }
  .filter-bar { flex-wrap: wrap; }
  .time-controls { flex-direction: column; gap: 1rem; }
  .time-range-buttons { flex-wrap: wrap; justify-content: center; }
  .news-container { grid-template-columns: 1fr; padding: 1rem; }
  .date-picker-container { flex-direction: column; }
  .modal-content { margin: 2rem 1rem; width: calc(100% - 2rem); }
  
  .severity-badge {
    font-size: 0.7rem;
    padding: 0.4rem 0.8rem;
    max-width: 80px;
  }
  
  .news-card h3 {
    font-size: 1.2rem;
    padding-right: 20px;
  }
  
  .code-background {
    font-size: 10px;
  }
  
  .ioc-list {
    grid-template-columns: 1fr;
  }
}
/* Sidebar Styles */
.sidebar {
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 250px;
  background: linear-gradient(180deg, #0a0a1a 0%, #1a1a2e 100%);
  border-right: 1px solid rgba(0, 128, 255, 0.2);
  z-index: 100;
  transition: all 0.3s ease;
  transform: translateX(-100%);
}

.sidebar.open {
  transform: translateX(0);
}

.sidebar-header {
  padding: 1.5rem;
  border-bottom: 1px solid rgba(0, 128, 255, 0.2);
  text-align: center;
}

.sidebar-logo {
  font-size: 1.5rem;
  font-weight: bold;
  background: linear-gradient(45deg, #0080ff, #00d4ff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.sidebar-menu {
  padding: 1rem 0;
}

.menu-item {
  display: flex;
  align-items: center;
  padding: 1rem 1.5rem;
  color: #b3d9ff;
  text-decoration: none;
  transition: all 0.3s ease;
  border-left: 3px solid transparent;
}

.menu-item:hover {
  background: rgba(0, 128, 255, 0.1);
  color: #ffffff;
  border-left: 3px solid #0080ff;
}

.menu-item.active {
  background: rgba(0, 128, 255, 0.2);
  color: #ffffff;
  border-left: 3px solid #0080ff;
}

.menu-item i {
  margin-right: 1rem;
  width: 20px;
  text-align: center;
}

/* Menu Toggle Styles */
.menu-toggle {
  position: fixed;
  top: 20px;
  left: 20px;
  width: 40px;
  height: 40px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  z-index: 1000;
  background: rgba(0, 128, 255, 0.2);
  border-radius: 50%;
  border: none;
  transition: all 0.3s ease;
}

.menu-toggle span {
  display: block;
  width: 20px;
  height: 2px;
  background: #0080ff;
  margin: 2px 0;
  transition: all 0.3s ease;
}

/* When sidebar is open, hide the toggle */
.sidebar.open ~ .menu-toggle {
  opacity: 0;
  visibility: hidden;
  transform: translateX(-50px);
}

/* When sidebar is closed, show the toggle */
.sidebar:not(.open) ~ .menu-toggle {
  opacity: 1;
  visibility: visible;
  transform: translateX(0);
}
  </style>
</head>
<body>
  <button class="menu-toggle" id="menuToggle">
  <span></span>
  <span></span>
  <span></span>
</button>
  <!-- Sidebar Menu -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="sidebar-logo">ThreatScape Command Center</div>
  </div>
  
  <div class="sidebar-menu">
    <a href="index.html" class="menu-item" id="threatIntelLink">
      <i class="fas fa-shield-alt"></i>
      <span>Threat Intel</span>
    </a>
    <a href="dashboard.html" class="menu-item" id="dashboardLink">
      <i class="fas fa-chart-line"></i>
      <span>Executive Dashboard</span>
    </a>
    <a href="reports.html" class="menu-item" id="reportsLink">
      <i class="fas fa-file-alt"></i>
      <span>Reports</span>
    </a>
  </div>
</div>

<div class="main-content" id="mainContent">
  <!-- Your existing content goes here -->
  <div class="code-background">
    <div class="code-line">if (threat.severity === 'critical') { executeCountermeasures(); deployPatches(); }</div>
    <div class="code-line">scan.ports([80, 443, 22, 3389]); analyze.traffic(packets); detect.anomalies();</div>
    <div class="code-line">firewall.block(malicious_ip); intrusion.detected = true; alert.security_team();</div>
    <div class="code-line">encrypt.data(aes256); validate.certificates(); monitor.network_activity();</div>
    <div class="code-line">vulnerability.scan(); patch.management(); compliance.audit();</div>
    <div class="code-line">malware.signature_update(); quarantine.infected_files(); backup.critical_data();</div>
    <div class="code-line">penetration.test(); social.engineering.awareness(); phishing.detection();</div>
    <div class="code-line">incident.response(); forensic.analysis(); threat.intelligence.feed();</div>
    <div class="code-line">zero_day.exploit.detected(); emergency.protocols.activated(); isolation.procedures();</div>
    <div class="code-line">authentication.multifactor(); access.control(); privilege.escalation.blocked();</div>
  </div>
  
  <div class="bg-animation"></div>
  
  <div class="alert-banner" id="alertBanner">
    🚨 CRITICAL THREAT DETECTED - New Zero-Day Vulnerability Reported
  </div>

  <header>
    <h1 class="title">ThreatScape Command Center</h1>
    <p class="subtitle">Live Threat Intelligence | IOC Driven | Enterprise Actionable</p>
  </header>

  <div class="stats-bar">
    <div class="stat-item">
      <div class="stat-number critical-count" id="criticalCount">0</div>
      <div class="stat-label">Critical</div>
    </div>
    <div class="stat-item">
      <div class="stat-number high-count" id="highCount">0</div>
      <div class="stat-label">High</div>
    </div>
    <div class="stat-item">
      <div class="stat-number medium-count" id="mediumCount">0</div>
      <div class="stat-label">Medium</div>
    </div>
    <div class="stat-item">
      <div class="stat-number low-count" id="lowCount">0</div>
      <div class="stat-label">Low</div>
    </div>
  </div>

  <div class="time-controls">
    <div class="time-range-buttons">
      <button class="time-btn" data-range="24h">24 Hours</button>
      <button class="time-btn" data-range="7d">7 Days</button>
      <button class="time-btn" data-range="1m">1 Month</button>
      <button class="time-btn" data-range="custom">Custom</button>
    </div>
    
    <div class="date-picker-container" id="datePickerContainer">
      <span class="calendar-label">From:</span>
      <input type="date" class="date-input" id="startDate">
      <span class="calendar-label">To:</span>
      <input type="date" class="date-input" id="endDate">
      <button class="search-btn" id="searchBtn">Search</button>
    </div>
    
    <button class="refresh-btn" id="refreshBtn">Refresh</button>
  </div>

  <div class="time-info" id="timeInfo">
    Showing current threat intelligence
  </div>

  <div class="filter-bar">
    <button class="filter-btn active" data-filter="all">All Threats</button>
    <button class="filter-btn" data-filter="critical">Critical</button>
    <button class="filter-btn" data-filter="high">High</button>
    <button class="filter-btn" data-filter="medium">Medium</button>
    <button class="filter-btn" data-filter="low">Low</button>
  </div>

  <main class="news-container" id="newsContainer">
    <div class="loading">
      <div class="spinner large"></div>
      Loading threat intelligence...
    </div>
  </main>

  <div class="modal" id="summaryModal">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h3 id="modalTitle"></h3>
      <div class="modal-severity" id="modalSeverity"></div>
      <div class="modal-meta">
        <span id="modalDate"></span>
        <span id="modalSource"></span>
      </div>
      <div class="modal-summary" id="modalSummary">
        <div class="loading-summary">
          <div class="spinner"></div>
          Generating AI summary...
        </div>
      </div>
      
      <!-- IOC Section -->
      <div class="ioc-toggle" id="iocToggle">
        <span> Show Indicators of Compromise (IOCs)</span>
        <span class="ioc-arrow">▼</span>
      </div>
      <div class="ioc-container" id="iocContainer">
        <div id="iocContent">
          <div class="loading-summary">
            <div class="spinner"></div>
            Loading Indicators of Compromise...
          </div>
        </div>
      </div>
      
      <a href="#" target="_blank" class="source-link" id="modalLink">🔗 View Original Article</a>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
const API_BASE_URL = window.location.origin;
let currentArticles = [];
let filteredArticles = [];
let currentModalArticle = null;

// Improved Sidebar Toggle Functionality
function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  const menuToggle = document.getElementById('menuToggle');
  
  sidebar.classList.toggle('open');
  
  if (sidebar.classList.contains('open')) {
    menuToggle.style.opacity = '0';
    menuToggle.style.visibility = 'hidden';
    menuToggle.style.pointerEvents = 'none';
    
    // Add click listener to close sidebar when clicking outside
    setTimeout(() => {
      document.addEventListener('click', closeSidebarOnClickOutside);
    }, 10);
  } else {
    menuToggle.style.opacity = '1';
    menuToggle.style.visibility = 'visible';
    menuToggle.style.pointerEvents = 'auto';
    
    // Remove the click listener
    document.removeEventListener('click', closeSidebarOnClickOutside);
  }
}

function closeSidebarOnClickOutside(e) {
  const sidebar = document.getElementById('sidebar');
  const menuToggle = document.getElementById('menuToggle');
  
  if (!sidebar.contains(e.target) && e.target !== menuToggle) {
    toggleSidebar();
  }
}

// Initialize event listeners
document.getElementById('menuToggle').addEventListener('click', function(e) {
  e.stopPropagation();
  toggleSidebar();
});

// Menu item click handlers
document.getElementById('threatIntelLink').addEventListener('click', function(e) {
  setActiveMenuItem('threatIntelLink');
});

document.getElementById('dashboardLink').addEventListener('click', function(e) {
  setActiveMenuItem('dashboardLink');
});

document.getElementById('reportsLink').addEventListener('click', function(e) {
  setActiveMenuItem('reportsLink');
});

function setActiveMenuItem(activeId) {
  document.querySelectorAll('.menu-item').forEach(item => {
    item.classList.remove('active');
  });
  document.getElementById(activeId).classList.add('active');
}

// Initialize dashboard
document.addEventListener('DOMContentLoaded', function() {
  setupEventListeners();
  loadThreats();
  initDateInputs();
});

function setupEventListeners() {
  // Time range buttons
  document.querySelectorAll('.time-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      
      if (this.dataset.range === 'custom') {
        document.getElementById('datePickerContainer').style.display = 'flex';
      } else {
        document.getElementById('datePickerContainer').style.display = 'none';
        applyFilters();
      }
    });
  });

  // Filter buttons
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      applyFilters();
    });
  });

  // Search button
  document.getElementById('searchBtn').addEventListener('click', searchThreats);
  
  // Refresh button
  document.getElementById('refreshBtn').addEventListener('click', loadThreats);
  
  // IOC toggle
  document.getElementById('iocToggle').addEventListener('click', toggleIOCs);
}

function toggleIOCs() {
  const container = document.getElementById('iocContainer');
  const arrow = document.querySelector('.ioc-arrow');
  
  container.classList.toggle('expanded');
  arrow.textContent = container.classList.contains('expanded') ? '▲' : '▼';
}

// Load threats from server
async function loadThreats() {
  try {
    showLoading(true);
    updateTimeInfo('Loading threat intelligence...');

    const response = await fetch(`${API_BASE_URL}/api/threats?full_month=true`);
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    
    const data = await response.json();
    currentArticles = data.threats || [];
    filteredArticles = [...currentArticles];
    
    displayArticles(filteredArticles);
    updateStats();
    updateTimeInfo(`Loaded ${currentArticles.length} threats`);
    
    // Show critical alert if needed
    if (currentArticles.some(article => article.severity === 'critical')) {
      showCriticalAlert();
    }
  } catch (error) {
    console.error('Failed to load threats:', error);
    showErrorState('Failed to load threat intelligence. Please try again later.');
  } finally {
    showLoading(false);
  }
}

// Search threats by date range
async function searchThreats() {
  const startDate = document.getElementById('startDate').value;
  const endDate = document.getElementById('endDate').value;
  
  if (!startDate || !endDate) {
    showToast('Please select both start and end dates');
    return;
  }

  try {
    showLoading(true);
    updateTimeInfo(`Searching threats from ${startDate} to ${endDate}...`);

    // Include full_month parameter for month-long searches
    const fullMonth = document.querySelector('.time-btn.active')?.dataset.range === '1m';
    const url = `${API_BASE_URL}/api/threats?start=${startDate}&end=${endDate}${fullMonth ? '&full_month=true' : ''}`;
    
    const response = await fetch(url);
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    
    const data = await response.json();
    currentArticles = data.threats || [];
    filteredArticles = [...currentArticles];
    
    displayArticles(filteredArticles);
    updateStats();
    updateTimeInfo(`Found ${currentArticles.length} threats in date range`);
  } catch (error) {
    console.error('Search failed:', error);
    showToast('Failed to search threats. Please try again.');
  } finally {
    showLoading(false);
  }
}

function applyFilters() {
  const activeFilter = document.querySelector('.filter-btn.active')?.dataset.filter || 'all';
  const activeTimeRange = document.querySelector('.time-btn.active')?.dataset.range || '24h';
  
  let filtered = [...currentArticles];
  
  // First apply time range filter if not custom
  if (activeTimeRange !== 'custom') {
    const now = new Date();
    let cutoffDate;
    
    switch(activeTimeRange) {
      case '24h':
        cutoffDate = new Date(now - 24 * 60 * 60 * 1000);
        break;
      case '7d':
        cutoffDate = new Date(now - 7 * 24 * 60 * 60 * 1000);
        break;
      case '1m':
        // Get first day of previous month at 00:00:00
        cutoffDate = new Date(now.getFullYear(), now.getMonth() - 1, 1);
        break;
    }
    
    filtered = filtered.filter(article => 
      new Date(article.publishedAt) >= cutoffDate
    );
  }
  
  // Then apply severity filter
  if (activeFilter !== 'all') {
    filtered = filtered.filter(article => 
      article.severity === activeFilter
    );
  }
  
  filteredArticles = filtered;
  displayArticles(filteredArticles);
  updateStats();
  
  // Update time info text
  if (activeTimeRange === 'custom') {
    updateTimeInfo(`Showing ${activeFilter === 'all' ? 'all' : activeFilter} threats in custom range (${filtered.length} articles)`);
  } else {
    const ranges = {
      '24h': 'last 24 hours',
      '7d': 'last 7 days', 
      '1m': 'last month'
    };
    updateTimeInfo(`Showing ${activeFilter === 'all' ? 'all' : activeFilter} threats from the ${ranges[activeTimeRange]} (${filtered.length} articles)`);
  }
}

function displayArticles(articles) {
  const container = document.getElementById('newsContainer');
  
  if (articles.length === 0) {
    container.innerHTML = `
      <div class="no-articles">
        <h3>No threats found</h3>
        <p>Try adjusting your filters or date range</p>
      </div>
    `;
    return;
  }

  container.innerHTML = articles.map(article => `
    <div class="news-card ${article.severity}" data-id="${article.id}">
      <div class="severity-badge ${article.severity}">${article.severity.toUpperCase()}</div>
      <div class="news-card-content">
        <h3>${article.title}</h3>
        <div class="preview-content">
          ${article.description ? article.description.substring(0, 200) + (article.description.length > 200 ? '...' : '') : 'No preview available'}
        </div>
        <button class="summarize-btn" data-id="${article.id}">
          🔍 AI Summarize
        </button>
      </div>
      <div class="news-card-footer">
        <div class="source-info">
          <span>${formatDateTime(new Date(article.publishedAt))}</span>
          <span>Source: ${article.source}</span>
        </div>
        ${article.url ? `
        <a href="${article.url}" target="_blank" class="source-link">
          🔗 View Source
        </a>` : ''}
      </div>
    </div>
  `).join('');

  // Add click handlers for summarize buttons
  document.querySelectorAll('.summarize-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const articleId = btn.dataset.id;
      const article = articles.find(a => a.id === articleId);
      if (article) {
        showSummaryModal(article);
      }
    });
  });

  // Add click handlers for entire cards
  document.querySelectorAll('.news-card').forEach(card => {
    card.addEventListener('click', (e) => {
      if (!e.target.closest('.summarize-btn') && !e.target.closest('a')) {
        const articleId = card.dataset.id;
        const article = articles.find(a => a.id === articleId);
        if (article && article.url) {
          window.open(article.url, '_blank');
        }
      }
    });
  });
}

function showSummaryModal(article) {
  currentModalArticle = article;
  const modal = document.getElementById('summaryModal');
  const modalTitle = document.getElementById('modalTitle');
  const modalSeverity = document.getElementById('modalSeverity');
  const modalDate = document.getElementById('modalDate');
  const modalSource = document.getElementById('modalSource');
  const modalLink = document.getElementById('modalLink');
  const modalSummary = document.getElementById('modalSummary');

  modalTitle.textContent = article.title;
  modalSeverity.textContent = article.severity.toUpperCase();
  modalSeverity.className = 'modal-severity ' + article.severity;
  modalDate.textContent = formatDateTime(new Date(article.publishedAt));
  modalSource.textContent = 'Source: ' + article.source;
  modalLink.href = article.url || '#';
  
  // Reset IOC section
  document.getElementById('iocContainer').classList.remove('expanded');
  document.querySelector('.ioc-arrow').textContent = '▼';
  document.getElementById('iocContent').innerHTML = `
    <div class="loading-summary">
      <div class="spinner"></div>
      Loading Indicators of Compromise...
    </div>
  `;
  
  modalSummary.innerHTML = `
    <div class="loading-summary">
      <div class="spinner"></div>
      Generating AI summary...
    </div>
  `;
  
  modal.style.display = 'block';
  document.body.style.overflow = 'hidden';
  
  // Close modal handlers
  document.querySelector('.close-modal').onclick = () => closeModal();
  window.onclick = (e) => {
    if (e.target === modal) {
      closeModal();
    }
  };
  
  // Fetch the summary and IOCs
  fetchArticleSummary(article);
  fetchIOCsForArticle(article.id);
}

function closeModal() {
  document.getElementById('summaryModal').style.display = 'none';
  document.body.style.overflow = 'auto';
  currentModalArticle = null;
}

async function fetchArticleSummary(article) {
  try {
    const modalSummary = document.getElementById('modalSummary');
    const contentToSummarize = article.description || article.title;
    
    const response = await fetch(`${API_BASE_URL}/api/summarize`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ 
        content: contentToSummarize,
        articleId: article.id 
      })
    });
    
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    
    const data = await response.json();
    
    // Process summary
    if (data.summary) {
      // Split main points and technical details
      const summaryParts = data.summary.split('\nTechnical Details:');
      let summaryHTML = summaryParts[0].split('\n')
        .filter(line => line.trim())
        .map(line => `<p>${line.replace('•', '')}</p>`)
        .join('');
      
      // Add technical details if present
      if (summaryParts[1]) {
        summaryHTML += `
          <div class="technical-details">
            <strong>Technical Details:</strong>
            <ul>
              ${summaryParts[1].split('\n')
                .filter(detail => detail.trim())
                .map(detail => `<li>${detail.replace('•', '').trim()}</li>`)
                .join('')}
            </ul>
          </div>
        `;
      }
      
      modalSummary.innerHTML = summaryHTML;
    } else {
      modalSummary.innerHTML = '<p>Could not generate summary</p>';
    }
  } catch (error) {
    console.error('Summary generation failed:', error);
    document.getElementById('modalSummary').innerHTML = `
      <p>Error generating summary. Please try again later.</p>
      <button class="refresh-btn" onclick="fetchArticleSummary(currentModalArticle)">Retry</button>
    `;
  }
}

async function fetchIOCsForArticle(articleId) {
  try {
    const response = await fetch(`${API_BASE_URL}/api/iocs/${articleId}`);
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    
    const data = await response.json();
    displayIOCs(data.iocs);
  } catch (error) {
    console.error('Failed to fetch IOCs:', error);
    document.getElementById('iocContent').innerHTML = `
      <p>Error loading IOCs. Please try again later.</p>
    `;
  }
}

function displayIOCs(iocs) {
  const iocContent = document.getElementById('iocContent');
  let iocHTML = '';
  let hasIOCs = false;
  
  // Helper function to create IOC sections
  const createIocSection = (title, items) => {
    if (items && items.length > 0) {
      hasIOCs = true;
      return `
        <div class="ioc-section">
          <h4>${title}</h4>
          <div class="ioc-list">
            ${items.map(item => `<div class="ioc-item">${item}</div>`).join('')}
          </div>
        </div>
      `;
    }
    return '';
  };
  
  // Network IOCs
  if (iocs.networkIOCs) {
    const network = iocs.networkIOCs;
    if (network.ipAddresses?.length) {
      iocHTML += createIocSection('IP Addresses', network.ipAddresses);
    }
    if (network.domains?.length) {
      iocHTML += createIocSection('Domains', network.domains);
    }
    if (network.urls?.length) {
      iocHTML += `
        <div class="ioc-section">
          <h4>URLs</h4>
          <div class="ioc-list">
            ${network.urls.map(url => `
              <div class="ioc-item">
                <a href="${url.startsWith('http') ? url : 'https://' + url}" 
                   target="_blank" 
                   rel="noopener noreferrer">
                  ${url}
                </a>
              </div>
            `).join('')}
          </div>
        </div>
      `;
      hasIOCs = true;
    }
    if (network.emails?.length) {
      iocHTML += createIocSection('Emails', network.emails);
    }
  }
  
  // File IOCs
  if (iocs.fileIOCs) {
    const file = iocs.fileIOCs;
    if (file.hashes?.length) {
      iocHTML += createIocSection('File Hashes', file.hashes);
    }
    if (file.filenames?.length) {
      iocHTML += createIocSection('Malicious Filenames', file.filenames);
    }
  }
  
  // Threat Intelligence
  if (iocs.threatIntelligence) {
    const threat = iocs.threatIntelligence;
    if (threat.cves?.length) {
      iocHTML += createIocSection('CVEs', threat.cves);
    }
    if (threat.malwareFamilies?.length) {
      iocHTML += createIocSection('Malware Families', threat.malwareFamilies);
    }
    if (threat.aptGroups?.length) {
      iocHTML += createIocSection('APT Groups', threat.aptGroups);
    }
    if (threat.ttps?.length) {
      iocHTML += createIocSection('TTPs (Tactics, Techniques & Procedures)', threat.ttps);
    }
  }
  
  // Host IOCs
  if (iocs.hostIOCs) {
    const host = iocs.hostIOCs;
    if (host.registryKeys?.length) {
      iocHTML += createIocSection('Registry Keys', host.registryKeys);
    }
    if (host.processes?.length) {
      iocHTML += createIocSection('Suspicious Processes', host.processes);
    }
  }
  
  // Behavioral IOCs
  if (iocs.behavioralIOCs) {
    const behavioral = iocs.behavioralIOCs;
    if (behavioral.scriptExecution?.length) {
      iocHTML += createIocSection('Script Execution Patterns', behavioral.scriptExecution);
    }
  }
  
  iocContent.innerHTML = hasIOCs ? iocHTML : '<p>No IOCs found in this article</p>';
}

function updateStats() {
  const stats = filteredArticles.reduce((acc, article) => {
    acc[article.severity] = (acc[article.severity] || 0) + 1;
    return acc;
  }, {critical: 0, high: 0, medium: 0, low: 0});

  document.getElementById('criticalCount').textContent = stats.critical;
  document.getElementById('highCount').textContent = stats.high;
  document.getElementById('mediumCount').textContent = stats.medium;
  document.getElementById('lowCount').textContent = stats.low;
}

function updateTimeInfo(message) {
  document.getElementById('timeInfo').textContent = message;
}

function showLoading(show) {
  const container = document.getElementById('newsContainer');
  if (show) {
    container.innerHTML = `
      <div class="loading">
        <div class="spinner large"></div>
        Loading threat intelligence...
      </div>
    `;
  }
}

function showErrorState(message) {
  const container = document.getElementById('newsContainer');
  container.innerHTML = `
    <div class="error-state">
      <h3>⚠️ Error</h3>
      <p>${message}</p>
      <button class="refresh-btn" onclick="loadThreats()">🔄 Retry</button>
    </div>
  `;
}

function showToast(message, duration = 3000) {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.classList.add('show');
  
  setTimeout(() => {
    toast.classList.remove('show');
  }, duration);
}

function showCriticalAlert() {
  const banner = document.getElementById('alertBanner');
  const criticalCount = currentArticles.filter(a => a.severity === 'critical').length;
  banner.textContent = `🚨 CRITICAL ALERT: ${criticalCount} active critical threats detected`;
  banner.classList.add('show');
  
  setTimeout(() => {
    banner.classList.remove('show');
  }, 4000);
}

function formatDateTime(date) {
  return date.toLocaleString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
}

function initDateInputs() {
  const today = new Date();
  const oneWeekAgo = new Date();
  oneWeekAgo.setDate(today.getDate() - 7);
  
  document.getElementById('startDate').valueAsDate = oneWeekAgo;
  document.getElementById('endDate').valueAsDate = today;
}

// Make functions available globally
window.loadThreats = loadThreats;
window.searchThreats = searchThreats;
window.fetchArticleSummary = fetchArticleSummary;
window.toggleIOCs = toggleIOCs;
  </script>
</body>
</html>
